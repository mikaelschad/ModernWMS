using Microsoft.AspNetCore.Mvc;using Microsoft.AspNetCore.Authorization;using ModernWMS.Backend.Models;using ModernWMS.Backend.Repositories;namespace ModernWMS.Backend.Controllers;[ApiController][Route("api/[controller]")][Authorize]public class LocationController:ControllerBase{private readonly ILocationRepository _repo;private readonly ILogger<LocationController>_log;public LocationController(ILocationRepository repo,ILogger<LocationController>log){_repo=repo;_log=log;}[HttpGet]public async Task<ActionResult<IEnumerable<Location>>>GetAll(){try{return Ok(await _repo.GetAllAsync());}catch(Exception ex){_log.LogError(ex,"Error fetching locations");return StatusCode(500,ex.Message);}}[HttpGet("{id}")]public async Task<ActionResult<Location>>GetById(string id){try{var l=await _repo.GetByIdAsync(id);if(l==null)return NotFound();return Ok(l);}catch(Exception ex){_log.LogError(ex,"Error fetching location {Id}",id);return StatusCode(500,ex.Message);}}[HttpPost]public async Task<ActionResult<Location>>Create([FromBody]Location l){try{if(string.IsNullOrEmpty(l.Id))return BadRequest("Location ID required");await _repo.CreateAsync(l);return CreatedAtAction(nameof(GetById),new{id=l.Id},l);}catch(Exception ex){_log.LogError(ex,"Error creating location {Id}",l.Id);return StatusCode(500,ex.Message);}}[HttpPut("{id}")]public async Task<IActionResult>Update(string id,[FromBody]Location l){try{if(id!=l.Id)return BadRequest("ID mismatch");if(!await _repo.UpdateAsync(l))return NotFound();return NoContent();}catch(Exception ex){_log.LogError(ex,"Error updating location {Id}",id);return StatusCode(500,ex.Message);}}[HttpDelete("{id}")]public async Task<IActionResult>Delete(string id){try{if(!await _repo.DeleteAsync(id))return NotFound();return NoContent();}catch(Exception ex){_log.LogError(ex,"Error deleting location {Id}",id);return StatusCode(500,ex.Message);}}}
